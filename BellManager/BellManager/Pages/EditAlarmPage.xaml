<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="BellManager.Pages.EditAlarmPage"
             Title="Edit Alarm">
    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="12">
            <!-- Header -->
            <Frame BackgroundColor="#4285F4" CornerRadius="16" Padding="20">
                <VerticalStackLayout>
                    <Label Text="Edit Alarm" FontSize="24" FontAttributes="Bold" TextColor="White" />
                    <Label Text="Set your alarm details" FontSize="16" TextColor="#E3F2FD" />
                </VerticalStackLayout>
            </Frame>

            <!-- Church Information -->
            <Frame BackgroundColor="#E8F5E8" CornerRadius="16" Padding="16" HasShadow="True" IsVisible="{Binding HasChurch}">
                <VerticalStackLayout>
                    <Label Text="Assigned Church" FontSize="14" FontAttributes="Bold" TextColor="#2E7D32" />
                    <Label Text="{Binding ChurchName}" FontSize="16" TextColor="#1B5E20" />
                    <Label Text="{Binding ChurchPhone}" FontSize="14" TextColor="#4CAF50" />
                </VerticalStackLayout>
            </Frame>

            <!-- Bell Name -->
            <Frame BackgroundColor="White" CornerRadius="16" Padding="16" HasShadow="True">
                <VerticalStackLayout>
                    <Label Text="Alarm Label" FontSize="16" FontAttributes="Bold" TextColor="#1A1A1A" />
                    <Entry Placeholder="Alarm label (optional)" Text="{Binding BellName}" />
                </VerticalStackLayout>
            </Frame>

            <!-- Time Selection -->
            <Frame BackgroundColor="White" CornerRadius="16" Padding="20" HasShadow="True">
                <VerticalStackLayout Spacing="16">
                    <Label Text="Time" FontSize="18" FontAttributes="Bold" TextColor="#1A1A1A" HorizontalOptions="Center" />
                    
                    <!-- Custom Time Picker -->
                    <Frame BackgroundColor="#F8F9FA" CornerRadius="12" Padding="16" HasShadow="False">
                        <Grid ColumnDefinitions="*,Auto,*" RowDefinitions="Auto,Auto" ColumnSpacing="12" RowSpacing="8">
                            <!-- Hour Section -->
                            <StackLayout Grid.Column="0" Grid.Row="0" HorizontalOptions="Center">
                                <Label Text="Hour" FontSize="12" TextColor="#666" HorizontalOptions="Center" />
                                <Frame BackgroundColor="White" CornerRadius="8" Padding="12,8" HasShadow="False">
                                    <Label x:Name="HourDisplay" 
                                           Text="{Binding SelectedHour, StringFormat='{0:D2}'}" 
                                           FontSize="24" 
                                           FontAttributes="Bold" 
                                           TextColor="#4285F4" 
                                           HorizontalOptions="Center" />
                                </Frame>
                            </StackLayout>
                            
                            <!-- Separator -->
                            <Label Grid.Column="1" Grid.Row="0" 
                                   Text=":" 
                                   FontSize="32" 
                                   FontAttributes="Bold"
                                   TextColor="#1A1A1A" 
                                   VerticalOptions="Center" 
                                   HorizontalOptions="Center" />
                            
                            <!-- Minute Section -->
                            <StackLayout Grid.Column="2" Grid.Row="0" HorizontalOptions="Center">
                                <Label Text="Minute" FontSize="12" TextColor="#666" HorizontalOptions="Center" />
                                <Frame BackgroundColor="White" CornerRadius="8" Padding="12,8" HasShadow="False">
                                    <Label x:Name="MinuteDisplay" 
                                           Text="{Binding SelectedMinute, StringFormat='{0:D2}'}" 
                                           FontSize="24" 
                                           FontAttributes="Bold" 
                                           TextColor="#4285F4" 
                                           HorizontalOptions="Center" />
                                </Frame>
                            </StackLayout>
                            
                            <!-- Time Adjustment Buttons -->
                            <Grid Grid.Column="0" Grid.Row="1" ColumnDefinitions="*,*" ColumnSpacing="8">
                                <Button Grid.Column="0" Text="âˆ’" FontSize="20" FontAttributes="Bold" 
                                        BackgroundColor="#E3F2FD" TextColor="#1976D2" CornerRadius="8" 
                                        Clicked="OnHourDownClicked" 
                                        x:Name="HourDownButton" />
                                <Button Grid.Column="1" Text="+" FontSize="20" FontAttributes="Bold" 
                                        BackgroundColor="#E3F2FD" TextColor="#1976D2" CornerRadius="8" 
                                        Clicked="OnHourUpClicked" 
                                        x:Name="HourUpButton" />
                            </Grid>
                            
                            <Grid Grid.Column="2" Grid.Row="1" ColumnDefinitions="*,*" ColumnSpacing="8">
                                <Button Grid.Column="0" Text="âˆ’" FontSize="20" FontAttributes="Bold" 
                                        BackgroundColor="#E3F2FD" TextColor="#1976D2" CornerRadius="8" 
                                        Clicked="OnMinuteDownClicked" 
                                        x:Name="MinuteDownButton" />
                                <Button Grid.Column="1" Text="+" FontSize="20" FontAttributes="Bold" 
                                        BackgroundColor="#E3F2FD" TextColor="#1976D2" CornerRadius="8" 
                                        Clicked="OnMinuteUpClicked" 
                                        x:Name="MinuteUpButton" />
                            </Grid>
                        </Grid>
                    </Frame>
                    
                    <!-- Quick Time Presets -->
                    <StackLayout Orientation="Horizontal" HorizontalOptions="Center" Spacing="8">
                        <Button Text="6:00 AM" FontSize="12" BackgroundColor="#E8F5E8" TextColor="#2E7D32" 
                                CornerRadius="16" Padding="12,6" Clicked="OnQuickTimeClicked" CommandParameter="6:00" />
                        <Button Text="8:00 AM" FontSize="12" BackgroundColor="#E8F5E8" TextColor="#2E7D32" 
                                CornerRadius="16" Padding="12,6" Clicked="OnQuickTimeClicked" CommandParameter="8:00" />
                        <Button Text="12:00 PM" FontSize="12" BackgroundColor="#E8F5E8" TextColor="#2E7D32" 
                                CornerRadius="16" Padding="12,6" Clicked="OnQuickTimeClicked" CommandParameter="12:00" />
                        <Button Text="6:00 PM" FontSize="12" BackgroundColor="#E8F5E8" TextColor="#2E7D32" 
                                CornerRadius="16" Padding="12,6" Clicked="OnQuickTimeClicked" CommandParameter="18:00" />
                    </StackLayout>
                </VerticalStackLayout>
            </Frame>

            <!-- Repeat Options -->
            <Frame BackgroundColor="White" CornerRadius="16" Padding="16" HasShadow="True">
                <VerticalStackLayout>
                    <Label Text="Repeat Options" FontSize="16" FontAttributes="Bold" TextColor="#1A1A1A" />
                    
                    <!-- Repeat Type Selection -->
                    <Picker x:Name="RepeatTypePicker" 
                            Title="Select repeat type" 
                            SelectedIndex="{Binding SelectedRepeatTypeIndex}"
                            ItemsSource="{Binding RepeatTypeOptions}" />
                    
                    <!-- Repeat Toggle - Available for all types -->
                    <Frame BackgroundColor="#F8F9FA" CornerRadius="8" Padding="12" Margin="0,10,0,0">
                        <StackLayout Orientation="Horizontal" Spacing="12">
                            <Switch IsToggled="{Binding IsRepeating}" 
                                    IsEnabled="{Binding HasSelectedDate, Converter={StaticResource InvertedBoolConverter}}" 
                                    OnColor="#4285F4" ThumbColor="White" />
                            <Label Text="Repeat every week" 
                                   TextColor="#666" 
                                   VerticalOptions="Center" FontSize="14" />
                        </StackLayout>
                    </Frame>
                    
                    <!-- Dynamic Explanation -->
                    <Label Text="{Binding RepeatExplanation}" 
                           FontSize="14" TextColor="#666" 
                           Margin="0,10,0,0" />
                    
                    <!-- Custom Option -->
                    <StackLayout IsVisible="{Binding IsCustomSelected}" Spacing="12" Margin="0,10,0,0">
                        <Label Text="Custom Day Selection" FontSize="16" FontAttributes="Bold" TextColor="#1A1A1A" />
                        <Label Text="Select specific days:" FontSize="14" TextColor="#666" />
                        
                        <!-- Days Selection -->
                        <Frame BackgroundColor="#F8F9FA" CornerRadius="8" Padding="12">
                            <Grid ColumnDefinitions="*,*,*,*,*,*,*" RowDefinitions="Auto,Auto" RowSpacing="8">
                                <Label Grid.Row="0" Grid.Column="0" Text="Sun" FontSize="12" HorizontalTextAlignment="Center" FontAttributes="Bold" />
                                <Label Grid.Row="0" Grid.Column="1" Text="Mon" FontSize="12" HorizontalTextAlignment="Center" FontAttributes="Bold" />
                                <Label Grid.Row="0" Grid.Column="2" Text="Tue" FontSize="12" HorizontalTextAlignment="Center" FontAttributes="Bold" />
                                <Label Grid.Row="0" Grid.Column="3" Text="Wed" FontSize="12" HorizontalTextAlignment="Center" FontAttributes="Bold" />
                                <Label Grid.Row="0" Grid.Column="4" Text="Thu" FontSize="12" HorizontalTextAlignment="Center" FontAttributes="Bold" />
                                <Label Grid.Row="0" Grid.Column="5" Text="Fri" FontSize="12" HorizontalTextAlignment="Center" FontAttributes="Bold" />
                                <Label Grid.Row="0" Grid.Column="6" Text="Sat" FontSize="12" HorizontalTextAlignment="Center" FontAttributes="Bold" />
                                
                                <CheckBox Grid.Row="1" Grid.Column="0" IsChecked="{Binding RepeatSun}" Color="#4285F4" />
                                <CheckBox Grid.Row="1" Grid.Column="1" IsChecked="{Binding RepeatMon}" Color="#4285F4" />
                                <CheckBox Grid.Row="1" Grid.Column="2" IsChecked="{Binding RepeatTue}" Color="#4285F4" />
                                <CheckBox Grid.Row="1" Grid.Column="3" IsChecked="{Binding RepeatWed}" Color="#4285F4" />
                                <CheckBox Grid.Row="1" Grid.Column="4" IsChecked="{Binding RepeatThu}" Color="#4285F4" />
                                <CheckBox Grid.Row="1" Grid.Column="5" IsChecked="{Binding RepeatFri}" Color="#4285F4" />
                                <CheckBox Grid.Row="1" Grid.Column="6" IsChecked="{Binding RepeatSat}" Color="#4285F4" />
                            </Grid>
                        </Frame>
                        
                        <!-- Date Picker Section -->
                        <Frame BackgroundColor="#F8F9FA" CornerRadius="8" Padding="12">
                            <VerticalStackLayout Spacing="8">
                                <StackLayout Orientation="Horizontal" Spacing="8">
                                    <Label Text="ðŸ“…" FontSize="16" VerticalOptions="Center" />
                                    <Label Text="Or select a specific date:" FontSize="14" TextColor="#666" VerticalOptions="Center" />
                                </StackLayout>
                                
                                <!-- Direct Date Picker with Icon -->
                                <Frame BackgroundColor="White" CornerRadius="8" Padding="12" HasShadow="False">
                                    <StackLayout Orientation="Horizontal" Spacing="8">
                                        <Label Text="ðŸ“…" FontSize="18" VerticalOptions="Center" />
                                        <DatePicker x:Name="DirectDatePicker"
                                                   Date="{Binding SelectedDate}"
                                                   MinimumDate="{Binding Today}"
                                                   MaximumDate="{Binding MaxDate}"
                                                   FontSize="16"
                                                   BackgroundColor="Transparent"
                                                   TextColor="#1A1A1A"
                                                   HorizontalOptions="FillAndExpand" />
                                    </StackLayout>
                                </Frame>
                                
                                <!-- Selected Date Display -->
                                <StackLayout IsVisible="{Binding HasSelectedDate}" Orientation="Horizontal" Spacing="8">
                                    <Label Text="Scheduled for:" FontSize="14" TextColor="#666" VerticalOptions="Center" />
                                    <Label Text="{Binding SelectedDateText}" FontSize="14" TextColor="#1A1A1A" FontAttributes="Bold" VerticalOptions="Center" />
                                    <Button Text="âœ•" 
                                            Command="{Binding ClearDateCommand}"
                                            BackgroundColor="#F44336"
                                            TextColor="White"
                                            CornerRadius="12"
                                            WidthRequest="24"
                                            HeightRequest="24"
                                            FontSize="12"
                                            HorizontalOptions="End" />
                                </StackLayout>
                            </VerticalStackLayout>
                        </Frame>
                        
                        <!-- Explanation for Custom -->
                        <Label Text="{Binding CustomExplanation}" 
                               FontSize="12" TextColor="#999" 
                               HorizontalOptions="Center" />
                    </StackLayout>
                </VerticalStackLayout>
            </Frame>

            <!-- Status -->
            <Frame BackgroundColor="White" CornerRadius="16" Padding="16" HasShadow="True">
                <VerticalStackLayout>
                    <Label Text="Status" FontSize="16" FontAttributes="Bold" TextColor="#1A1A1A" />
                    <Switch IsToggled="{Binding IsEnabled}" OnColor="#4285F4" ThumbColor="White" />
                    <Label Text="Enable this alarm" FontSize="14" TextColor="#666" />
                </VerticalStackLayout>
            </Frame>

            <!-- Notes -->
            <Frame BackgroundColor="White" CornerRadius="16" Padding="16" HasShadow="True">
                <VerticalStackLayout>
                    <Label Text="Notes" FontSize="16" FontAttributes="Bold" TextColor="#1A1A1A" />
                    <Entry Placeholder="Add notes (optional)" Text="{Binding Notes}" />
                </VerticalStackLayout>
            </Frame>

            <!-- Save Button -->
            <Button Text="Save Alarm" 
                    BackgroundColor="#4285F4" 
                    TextColor="White" 
                    FontSize="18" 
                    FontAttributes="Bold" 
                    CornerRadius="16" 
                    HeightRequest="56" 
                    Command="{Binding SaveCommand}" />
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
