<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:helpers="clr-namespace:BellManager.Helpers"
             x:Class="BellManager.Pages.AlarmsPage"
             Title="{Binding Source={x:Static helpers:LocalizationResourceManager.Instance}, Path=[Clock]}"
             BackgroundColor="#F5F7FA">

    <ContentPage.Resources>
        <ResourceDictionary>
            <Style x:Key="AlarmCardStyle" TargetType="Frame">
                <Setter Property="BackgroundColor" Value="White"/>
                <Setter Property="CornerRadius" Value="16"/>
                <Setter Property="HasShadow" Value="True"/>
                <Setter Property="Margin" Value="16,8"/>
                <Setter Property="Padding" Value="0"/>
            </Style>

            <Style x:Key="AlarmTimeStyle" TargetType="Label">
                <Setter Property="FontSize" Value="48"/>
                <Setter Property="FontAttributes" Value="None"/>
                <Setter Property="TextColor" Value="#333"/>
                <Setter Property="FontFamily" Value="OpenSansRegular"/>
            </Style>

            <Style x:Key="AlarmLabelStyle" TargetType="Label">
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="TextColor" Value="#666"/>
                <Setter Property="Margin" Value="0,4,0,0"/>
            </Style>

            <Style x:Key="RepeatInfoStyle" TargetType="Label">
                <Setter Property="FontSize" Value="13"/>
                <Setter Property="TextColor" Value="#5527ad"/>
                <Setter Property="Margin" Value="0,2,0,0"/>
                <Setter Property="FontAttributes" Value="Bold"/>
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="{Binding Source={x:Static helpers:LocalizationResourceManager.Instance}, Path=[Logout]}" Clicked="OnLogoutClicked" />
    </ContentPage.ToolbarItems>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Header Section -->
        <Frame Grid.Row="0" BackgroundColor="#5527ad" CornerRadius="0" HasShadow="False" Padding="20,20,20,20" BorderColor="Transparent">
            <StackLayout Orientation="Horizontal" HorizontalOptions="FillAndExpand">
                <Label Text="{Binding Source={x:Static helpers:LocalizationResourceManager.Instance}, Path=[MyAlarmsTitle]}" FontSize="24" FontAttributes="Bold" TextColor="White" VerticalOptions="Center"/>
                <Label x:Name="CurrentTimeLabel" FontSize="14" TextColor="#E0E0E0" VerticalOptions="Center" HorizontalOptions="EndAndExpand"/>
            </StackLayout>
        </Frame>

        <!-- Alarms List -->
        <ScrollView Grid.Row="1" Margin="0,16,0,80">
            <CollectionView ItemsSource="{Binding Alarms}"
                          SelectionMode="None"
                          x:Name="AlarmsList"
                          BackgroundColor="Transparent">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Style="{StaticResource AlarmCardStyle}">
                            <Grid Padding="20,16" ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto,Auto">
                                
                                <!-- Main Time Display -->
                                <StackLayout Grid.Column="0" Grid.Row="0" Orientation="Horizontal" Spacing="0" VerticalOptions="End">
                                    <Label Text="{Binding TimeDisplay}" Style="{StaticResource AlarmTimeStyle}"/>
                                    <Label Text="{Binding AmPmDisplay}" FontSize="20" TextColor="#999" VerticalOptions="End" Margin="4,0,0,8"/>
                                </StackLayout>

                                <!-- Enable/Disable Switch -->
                                <Switch Grid.Column="1" Grid.Row="0" 
                                      IsToggled="{Binding IsEnabled}" 
                                      OnColor="#5527ad"
                                      ThumbColor="White"
                                      VerticalOptions="Center"/>

                                <!-- Alarm Label -->
                                <Label Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="2"
                                     Text="{Binding BellName}" 
                                     Style="{StaticResource AlarmLabelStyle}"
                                     IsVisible="{Binding HasBellName}"/>

                                <!-- Repeat Information -->
                                <Label Grid.Column="0" Grid.Row="2" Grid.ColumnSpan="2"
                                     Text="{Binding RepeatInfo}" 
                                     Style="{StaticResource RepeatInfoStyle}"
                                     IsVisible="{Binding HasRepeatInfo}"/>

                                <!-- Action Buttons -->
                                <StackLayout Grid.Row="3" Grid.ColumnSpan="2" Orientation="Horizontal" Spacing="16" Margin="0,16,0,0">
                                    <Button Text="{Binding Source={x:Static helpers:LocalizationResourceManager.Instance}, Path=[Edit]}" 
                                            FontSize="14"
                                            TextColor="#5527ad"
                                            BackgroundColor="#F3E5F5"
                                            CornerRadius="8"
                                            HeightRequest="36"
                                            Padding="16,0"
                                            Command="{Binding Path=BindingContext.ItemTappedCommand, Source={x:Reference AlarmsList}}" 
                                            CommandParameter="{Binding .}"/>
                                    
                                    <Button Text="{Binding Source={x:Static helpers:LocalizationResourceManager.Instance}, Path=[Delete]}" 
                                            FontSize="14"
                                            TextColor="#D32F2F"
                                            BackgroundColor="#FFEBEE"
                                            CornerRadius="8"
                                            HeightRequest="36"
                                            Padding="16,0"
                                            Command="{Binding Path=BindingContext.DeleteCommand, Source={x:Reference AlarmsList}}" 
                                            CommandParameter="{Binding .}"/>
                                </StackLayout>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </ScrollView>

        <!-- Floating Add Button -->
        <Frame Grid.Row="1" 
               CornerRadius="28" 
               HeightRequest="56" 
               WidthRequest="56" 
               Padding="0" 
               BackgroundColor="#5527ad" 
               HasShadow="True" 
               VerticalOptions="End" 
               HorizontalOptions="Center" 
               Margin="0,0,0,24">
            <Button Text="+" 
                  BackgroundColor="Transparent" 
                  TextColor="White"
                  FontSize="32"
                  FontAttributes="None"
                  HorizontalOptions="Center"
                  VerticalOptions="Center"
                  Command="{Binding AddCommand}" 
                  CornerRadius="28"/>
        </Frame>
    </Grid>
</ContentPage>